<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adedonha Multiplayer - Python</title>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.97); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-fade-in {
            animation: fadeIn 0.25s ease-out;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 min-h-screen">
    <div class="min-h-screen flex items-center justify-center p-4">
        <div class="max-w-md w-full">
            <!-- Header -->
            <div class="text-center mb-8">
                <div class="flex items-center justify-center mb-4">
                    <i class="fas fa-gamepad text-6xl text-purple-600"></i>
                </div>
                <h1 class="text-5xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-2">
                    Adedonha
                </h1>
                <p class="text-gray-600 text-lg">Jogue Adedonha online com seus amigos!</p>
                
                <!-- Status de conexão -->
                <div class="mt-4">
                    <span id="connection-status" class="inline-flex items-center gap-2 text-gray-600 text-sm">
                        <span class="w-2 h-2 bg-gray-400 rounded-full"></span>
                        Conectando...
                    </span>
                </div>
            </div>

            <!-- Card Principal -->
            <div class="bg-white rounded-2xl shadow-xl p-6 border border-gray-100">
                <!-- Nome do Jogador -->
                <div class="mb-6 relative">
                    <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center justify-between">
                        <span>Seu Nome</span>
                        <!-- Botão de Ajuda -->
                        <button id="open-how-to-play" class="p-2 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:scale-110 transition-transform shadow-md hover:shadow-lg">
                            <span>Como Jogar</span>
                            <i class="fas fa-question"></i>                            
                        </button>
                    </label>
                
                    <input
                    type="text"
                    id="player-name"
                    placeholder="Digite seu nome"
                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition-all"
                    maxlength="20"
                    />
                </div>
  

                <!-- Botões de Ação -->
                <div id="main-buttons" class="space-y-3">
                    <button
                        onclick="createRoom()"
                        class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 flex items-center justify-center gap-2"
                    >
                        <i class="fas fa-plus"></i>
                        Criar Nova Sala
                    </button>
                    
                    <button
                        onclick="showJoinRoom()"
                        class="w-full bg-white text-purple-600 font-semibold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transform hover:scale-105 transition-all duration-200 border-2 border-purple-200 flex items-center justify-center gap-2"
                    >
                        <i class="fas fa-sign-in-alt"></i>
                        Entrar em uma Sala
                    </button>
                </div>

                <!-- Form Entrar na Sala (oculto inicialmente) -->
                <div id="join-room-form" class="space-y-3 hidden">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Código da Sala
                        </label>
                        <input
                            type="text"
                            id="room-code"
                            placeholder="Ex: ABC12345"
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition-all uppercase"
                            maxlength="8"
                        />
                    </div>

                    <button
                        onclick="joinRoom()"
                        class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 flex items-center justify-center gap-2"
                    >
                        <i class="fas fa-users"></i>
                        Entrar na Sala
                    </button>

                    <button
                        onclick="showMainButtons()"
                        class="w-full bg-white text-purple-600 font-semibold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transition-all duration-200 border-2 border-purple-200"
                    >
                        Voltar
                    </button>
                </div>
            </div>

            <!-- Footer -->
            <div class="text-center mt-6 text-lg text-gray-500">
                <p>Jogo multiplayer em tempo real</p>                
            </div>
            <div class="text-center mt-2 text-sm text-gray-500">                
                <p>Luiz Nunes - Webdev</p>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        let connected = false;

        socket.on('connect', () => {
            connected = true;
            updateConnectionStatus(true);
            console.log('Conectado ao servidor');
        });

        socket.on('disconnect', () => {
            connected = false;
            updateConnectionStatus(false);
            console.log('Desconectado do servidor');
        });

        socket.on('room_created', (data) => {
            console.log('Sala criada:', data);
            sessionStorage.setItem('roomData', JSON.stringify(data.room));
            sessionStorage.setItem('playerData', JSON.stringify(data.player));
            // GARANTIA: atualiza também localStorage com o nome retornado pelo servidor
            if (data.player && data.player.name) {
                localStorage.setItem('player_name', data.player.name);
            }
            const roomId = data.room_id || data.room.id;
            window.location.href = `/room/${roomId}`;
        });

        socket.on('room_joined', (data) => {
            console.log('Entrou na sala:', data);
            console.log('Room ID:', data.room_id);
            sessionStorage.setItem('roomData', JSON.stringify(data.room));
            sessionStorage.setItem('playerData', JSON.stringify(data.player));

            if (data.player && data.player.name) {
                localStorage.setItem('player_name', data.player.name);
            }
            // Usar o room_id correto do retorno
            const roomId = data.room_id || data.room.id;
            window.location.href = `/room/${roomId}`;
            //player_name = document.getElementById("playerNameInput").value.trim();
            //localStorage.setItem("player_name", player_name);
        });

        socket.on('error', (data) => {
            alert(data.message);
        });

        function updateConnectionStatus(isConnected) {
            const statusEl = document.getElementById('connection-status');
            if (isConnected) {
                statusEl.innerHTML = '<span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> Conectado';
                statusEl.className = 'inline-flex items-center gap-2 text-green-600 text-sm';
            } else {
                statusEl.innerHTML = '<span class="w-2 h-2 bg-red-500 rounded-full"></span> Desconectado';
                statusEl.className = 'inline-flex items-center gap-2 text-red-600 text-sm';
            }
        }

        function createRoom() {
            const playerName = document.getElementById('player-name').value.trim();

            if (!playerName) {
                alert('Por favor, digite seu nome!');
                return;
            }

            if (!connected) {
                alert('Conectando ao servidor...');
                return;
            }

            // Salva NO localStorage ANTES de emitir (garante que a aba/cliente atual tem o nome correto)
            localStorage.setItem('player_name', playerName);
            // opcional: também salvar no sessionStorage por aba (se quiser comportamento por aba)
            // sessionStorage.setItem('player_name', playerName);

            // Agora emite para o servidor
            socket.emit('create_room', { player_name: playerName });
        }


        function joinRoom() {
            const playerName = document.getElementById('player-name').value.trim();
            const roomCode = document.getElementById('room-code').value.trim().toUpperCase();

            if (!playerName) {
                alert('Por favor, digite seu nome!');
                return;
            }

            if (!roomCode) {
                alert('Por favor, digite o código da sala!');
                return;
            }

            if (!connected) {
                alert('Conectando ao servidor...');
                return;
            }

            // Salva o nome ANTES de emitir
            localStorage.setItem('player_name', playerName);
            // sessionStorage.setItem('player_name', playerName); // opcional, por aba

            socket.emit('join_room', { 
                room_id: roomCode, 
                player_name: playerName 
            });
        }


        function showJoinRoom() {
            document.getElementById('main-buttons').classList.add('hidden');
            document.getElementById('join-room-form').classList.remove('hidden');
        }

        function showMainButtons() {
            document.getElementById('join-room-form').classList.add('hidden');
            document.getElementById('main-buttons').classList.remove('hidden');
        }
    </script>

    <!-- Modal de Instruções -->
    <div id="how-to-play-modal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div
            class="bg-gradient-to-b from-white via-purple-50 to-pink-50 rounded-2xl shadow-2xl w-11/12 max-w-3xl max-h-[90vh] overflow-y-auto p-6 relative animate-fade-in border border-purple-100">
            
            <!-- Botão Fechar -->
            <button id="close-how-to-play"
                class="absolute top-3 right-3 text-gray-500 hover:text-gray-800 transition transform hover:scale-110">
                <i class="fas fa-times text-xl"></i>
            </button>

            <!-- Cabeçalho -->
            <div class="text-center mb-6">
                <div
                    class="mx-auto w-14 h-14 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center shadow-lg mb-3">
                    <i class="fas fa-lightbulb text-white text-2xl"></i>
                </div>
                <h2 class="text-3xl font-bold text-purple-700 mb-1">Como Jogar & Usar o Sistema</h2>
                <p class="text-gray-600 text-sm md:text-base">
                Um guia rápido e bonito para jogar com os amigos sem confusão ✨
                </p>
            </div>

            <!-- Conteúdo com rolagem -->
            <div class="space-y-6 text-gray-700 text-sm md:text-base leading-relaxed">
                <div>
                <h3 class="font-semibold text-purple-700 mb-2 flex items-center gap-2">
                    <i class="fas fa-user-plus text-pink-500"></i> Passo a passo
                </h3>
                <ol class="list-decimal ml-5 space-y-3">
                    <li>
                    <strong>Criar sala (Anfitrião):</strong> O Jogador que criar a sala, será automaticamente defindo como "Anfitrião".
                     Para isso basta digitar seu nome na tela inicial e clicar em 
                    <span class="font-semibold">"Criar Nova Sala"</span>. Um código será gerado (ex.:
                    <code class="bg-gray-100 px-2 rounded text-sm">AB12CD34</code>) — copie e envie para seus amigos.
                    </li>

                    <li>
                    <strong>Entrar na sala (Convidados):</strong> Não crie outra sala! Digite seu nome e clique em
                    <span class="font-semibold">"Entrar em uma Sala"</span>, cole o código e entre.
                    </li>

                    <li>
                    <strong>Reconexão automática:</strong> Se a página for recarregada, use o mesmo nome para que o sistema te reconheça
                    automaticamente, caso crie dois jogadores com o mesmo nome, peça para o anfitrião excluir um dos dois.
                    </li>

                    <li>
                    <strong>Iniciar rodada:</strong> Somente o anfitrião pode começar. Quando todos estiverem prontos,
                    clique em <span class="font-semibold">"Iniciar Rodada"</span>.
                    </li>

                    <li>
                    <strong>Responder & Parar:</strong> Preencha as categorias com palavras que comecem pela letra sorteada
                    e clique em <span class="font-semibold">"PARE!"</span> quando terminar.
                    </li>

                    <li>
                    <strong>Validação e pontuação:</strong> O jogo converte automaticamente as palavras para maiúsculo, 
                    para minimizar erros, invalida automaticamente palavras que não comecem pela letra sorteada ou que só possuam
                    uma letra. Dá meio ponto para palavras iguais. O anfitrião pode analisar as respostas e dar meio ponto para 
                    determinada resposta, caso sejam iguais mas escritas de forma diferente, por exemplo: "Enxada" e "Enchada", 
                    ou pode invalidar palavras que possam ser consideradas como erradas, a depender do concenso entre os demais 
                    jogadores. Depois de verificar todas as respostas basta clicar em <span class="font-semibold">"Calcular Pontuação"</span> 
                    que o sistema irá mostrar o ranking.
                    </li>

                    <li>
                    <strong>Encerrar ou reiniciar partida:</strong> O anfitrião pode encerrar ou iniciar uma nova rodada,
                    mantendo os jogadores na mesma sala.
                    </li>
                </ol>
                </div>

                <div class="bg-white/70 p-4 rounded-lg border border-purple-100 shadow-sm">
                <h4 class="font-semibold text-purple-700 mb-2 flex items-center gap-2">
                    <i class="fas fa-star text-yellow-400"></i> Dicas rápidas
                </h4>
                <ul class="space-y-2">
                    <li>✅ <strong>Anfitrião:</strong> cria sala, inicia rodadas, valida respostas e gerencia os jogadores.</li>
                    <li>✅ <strong>Jogadores:</strong> entram com o código e jogam em tempo real.</li>
                    <li>💬 <strong>Chat:</strong> use o chat para combinar regras ou conversar durante o jogo.</li>
                    <li>📱 <strong>Mobile:</strong> compatível com celular — role a tela para ver tudo.</li>
                    <li>⚠️ <strong>Atenção:</strong> se receber um código, <em>não crie uma nova sala</em>!</li>
                </ul>
                </div>

                <!-- FAQ -->
                <div>
                    <h4 class="font-semibold text-purple-700 mb-2 flex items-center gap-2">
                        <i class="fas fa-question-circle text-blue-500"></i> Perguntas frequentes
                    </h4>
                    <details class="mb-2">
                        <summary class="cursor-pointer font-medium">Às vezes, quando vou acessar o jogo aparece uma tela estranha e não entra o que pode ser?</summary>
                        <div class="mt-1 pl-4 text-gray-600">
                            Como a hospedagem é gratuita, se o jogo ficar um tempo sem nenhum acesso, o servidor entra em estado de hibernação.
                            Mas não se preocupe, aguarde o processo de recarga, que leva em torno de 30 segundos e ele abre o jogo automaticamente.
                            Não clique em nada, só aguarde este tempo, obrigado.
                        </div>
                    </details>
                    <details>
                        <summary class="cursor-pointer font-medium">O que fazer se aparecer “Anônimo”?</summary>
                        <div class="mt-1 pl-4 text-gray-600">
                            Verifique se você digitou o nome antes de entrar na sala — o jogo usa esse nome para identificá-lo.
                        </div>
                    </details>
                    <details>
                        <summary class="cursor-pointer font-medium">A sala não existe?</summary>
                        <div class="mt-1 pl-4 text-gray-600">
                            Pode ter sido encerrada pelo anfitrião. Peça para ele criar uma nova e enviar o novo código.
                        </div>
                    </details>
                    <details>
                        <summary class="cursor-pointer font-medium">Por quanto tempo esse jogo estará disponível?</summary>
                        <div class="mt-1 pl-4 text-gray-600">
                            É difícil responder a essa pergunta, pois depende de alguns fatores, por exemplo: o custo de manter no ar.
                            Por enquanto não estou tendo custo, porém, a hospedagem gratuita tem limitações, pode ser que em determinado momento
                            o jogo seja interrompido.
                        </div>
                    </details>
                </div>

                <!-- Botão inferior -->
                <div class="text-center pt-4">
                <button id="close-how-to-play-bottom"
                    class="bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold py-2 px-6 rounded-full shadow-md hover:scale-105 transition-all">
                    Entendi, vamos jogar! 🎮
                </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
          const openModalBtn = document.getElementById("open-how-to-play");
          const modal = document.getElementById("how-to-play-modal");
          const closeModalBtns = [
            document.getElementById("close-how-to-play"),
            document.getElementById("close-how-to-play-bottom")
          ];
      
          if (openModalBtn && modal) {
            // Abrir modal
            openModalBtn.addEventListener("click", () => {
              modal.classList.remove("hidden");
              document.body.style.overflow = "hidden";
            });
      
            // Fechar modal (pelos botões)
            closeModalBtns.forEach(btn => {
              if (btn) {
                btn.addEventListener("click", () => {
                  modal.classList.add("hidden");
                  document.body.style.overflow = "auto";
                });
              }
            });
      
            // Fechar clicando fora do conteúdo
            modal.addEventListener("click", (e) => {
              if (e.target === modal) {
                modal.classList.add("hidden");
                document.body.style.overflow = "auto";
              }
            });
          } else {
            console.warn("⚠️ Botão ou modal de instruções não encontrados.");
          }
        });
    </script>
      
        
</body>
</html>
